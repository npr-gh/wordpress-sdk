!function(){var e={703:function(e,t,o){"use strict";var r=o(414);function n(){}function a(){}a.resetWarningCache=n,e.exports=function(){function e(e,t,o,n,a,s){if(s!==r){var i=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw i.name="Invariant Violation",i}}function t(){return e}e.isRequired=e;var o={array:e,bigint:e,bool:e,func:e,number:e,object:e,string:e,symbol:e,any:e,arrayOf:t,element:e,elementType:e,instanceOf:t,node:e,objectOf:t,oneOf:t,oneOfType:t,shape:t,exact:t,checkPropTypes:a,resetWarningCache:n};return o.PropTypes=o,o}},697:function(e,t,o){e.exports=o(703)()},414:function(e){"use strict";e.exports="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED"}},t={};function o(r){var n=t[r];if(void 0!==n)return n.exports;var a=t[r]={exports:{}};return e[r](a,a.exports,o),a.exports}o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,{a:t}),t},o.d=function(e,t){for(var r in t)o.o(t,r)&&!o.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},function(){"use strict";var e=window.wp.element,t=window.wp.data;const{get:r}=lodash,n=e=>r(window,"wordproofSdk.data"+(e?`.${e}`:""),{});var a=window.wp.apiFetch,s=o.n(a);async function i(e,t,o){let r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:200;try{const n=await e();return!!n&&(n.status===r?t(n):o(n))}catch(e){console.error(e.message)}}async function c(e){try{return await s()(e)}catch(e){return e.error&&e.status?e:e instanceof Response&&await e.json()}}const p=async()=>await i((async()=>await d()),(e=>e),(()=>!1)),d=async()=>await c({path:"wordproof/v1/oauth/destroy",method:"POST"});var u=window.wp.i18n;const l=(0,u.sprintf)(
/** Translators: %s expands to WordProof */
(0,u.__)("%s has successfully timestamped this page.","wordpress-timestamp"),"WordProof"),w=(0,u.sprintf)(
/** Translators: %s expands to WordProof */
(0,u.__)("%s failed to timestamp this page. Please check if you're correctly authenticated with WordProof and try to save this page again.","wordpress-timestamp"),"WordProof"),f=(0,u.sprintf)(
/** Translators: %s expands to WordProof */
(0,u.__)("You are out of timestamps. Please upgrade your account by opening the %s settings.","wordpress-timestamp"),"WordProof");var m=o(697),h=o.n(m);function y(e){const t=new window.CustomEvent(e);console.warn("Event dispatch: "+e),window.dispatchEvent(t)}const _=e=>{const{response:t,createSuccessNotice:o,createErrorNotice:r,postId:n}=e;if(null===t||200===t.status)return;const a={id:"wordproof-timestamp-notice"};t&&201===t.status?0===t.balance?r(f,a):(o(l,{type:"snackbar",id:"wordproof-timestamp-notice"}),g(n,t.hash)):r(w,a)},g=async(e,t)=>{setTimeout((async()=>{(await(async e=>c({path:`wordproof/v1/posts/${e}/timestamp/transaction/latest`,method:"GET"}))(e)).hash!==t&&y("wordproof:webhook:failed")}),1e4)};_.proptypes={timestampResponse:h().any.isRequired,createSuccessNotice:h().func.isRequired,createErrorNotice:h().func.isRequired,postId:h().number.isRequired};const{debounce:v}=lodash,{applyFilters:E}=wp.hooks,{select:b}=wp.data;const{dispatch:P}=wp.data;function k(){const{setIsAuthenticated:e}=P("wordproof"),t=n("popup_redirect_authentication_url"),o=n("popup_redirect_settings_url");let r=null;const a=(e,t)=>{r=function(e,t){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:800,n=arguments.length>4&&void 0!==arguments[4]?arguments[4]:600;const a=e.top.outerHeight/2+e.top.screenY-n/2,s=e.top.outerWidth/2+e.top.screenX-r/2;return e.open(t,o,`toolbar=no,\n\t\tlocation=no,\n\t\tdirectories=no,\n\t\tstatus=no,\n\t\tmenubar=no,\n\t\tresizable=no,\n\t\tcopyhistory=no,\n\t\twidth=${r},\n\t\theight=${n},\n\t\ttop=${a},\n\t\tleft=${s}`)}(window,e,t),r&&r.focus(),window.addEventListener("message",s,!1)},s=async e=>{const{data:t,source:o,origin:a}=e;if(a===n("origin")&&r===o)switch(console.warn("Post message: "+t.type),t.type){case"wordproof:oauth:granted":!1===await u(t)&&await d("wordproof:oauth:failed",!1);break;case"wordproof:oauth:failed":await d("wordproof:oauth:failed",!1);break;case"wordproof:oauth:denied":await d("wordproof:oauth:denied",!1);break;case"wordproof:webhook:success":await d("wordproof:oauth:success",!0);break;case"wordproof:webhook:failed":await d("wordproof:webhook:failed",!1);break;case"wordproof:settings:updated":await d("wordproof:settings:updated"),await(async()=>await i((async()=>await(async()=>await c({path:"wordproof/v1/settings",method:"GET"}))()),(e=>e),(()=>!1)))();break;case"wordproof:oauth:destroy":await d("wordproof:oauth:destroy",!1)}},d=async function(t){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;window.removeEventListener("message",s,!1),y(t),!1===o&&(await p(),e(!1)),!0===o&&e(!0),r.close()},u=async e=>{await i((()=>(async e=>{let{state:t,code:o}=e;return await c({path:"wordproof/v1/oauth/authenticate",method:"POST",data:{state:t,code:o}})})(e)),(async e=>{const t={type:"wordproof:sdk:access-token",source_id:e.source_id};return r.postMessage(t,n("origin")),!0}),(async e=>!1))};window.addEventListener("wordproof:open_authentication",(e=>{e.preventDefault(),a(t,"WordProof_Authentication")}),!1),window.addEventListener("wordproof:open_settings",(e=>{e.preventDefault(),a(o,"WordProof_Settings")}),!1)}const{subscribe:R,select:T}=wp.data;function S(e){let t=!0;R((()=>{const o=T("core/editor").isSavingPost(),r=T("core/editor").isAutosavingPost(),n=T("core/editor").didPostSaveRequestSucceed();if(o&&n&&!r){if(t)return void(t=!1);e()}}))}const{__:__}=wp.i18n,{useCallback:q}=wp.element,{withSelect:O}=wp.data,{compose:A}=wp.compose,C=t=>{const{isAuthenticated:o}=t,r=n("popup_redirect_authentication_url"),a=n("popup_redirect_settings_url"),s=q((e=>{e.preventDefault(),y("wordproof:open_settings")})),i=q((e=>{e.preventDefault(),y("wordproof:open_authentication")}));return(0,e.createElement)(e.Fragment,null,o&&(0,e.createElement)("a",{href:a,onClick:s},__("Open Settings","wordproof_timestamp")),!o&&(0,e.createElement)("a",{href:r,onClick:i},__("Open Authentication","wordproof_timestamp")))};C.proptypes={isAuthenticated:h().bool.isRequired};var W=A([O((e=>({isAuthenticated:e("wordproof").getIsAuthenticated()})))])(C);const{Modal:D}=wp.components,I=t=>{const{title:o,children:r,close:n}=t;return(0,e.createElement)(e.Fragment,null,(0,e.createElement)(D,{title:o,onRequestClose:n},r),") }")};I.proptypes={title:h().string.isRequired,children:h().any,close:h().func.isRequired};var L=I;const{Button:M}=wp.components,{useCallback:N}=wp.element,{__:x}=wp.i18n,F=()=>{const{close:t}=props,o=N((e=>{e.preventDefault(),y("wordproof:open_authentication")}));return(0,e.createElement)(L,{close:t,title:x("Authentication denied","wordproof_timestamp")},(0,e.createElement)(e.Fragment,null,(0,e.createElement)("p",null,x("You need to allow WordProof to access your site to finish the WordProof installation.","wordproof_sdk")),(0,e.createElement)(M,{variant:"primary",onClick:o},x("Retry authentication","wordproof_timestamp"))))};F.proptypes={close:h().func.isRequired};var $=F;const{Button:j}=wp.components,{useCallback:Y}=wp.element,{__:B}=wp.i18n,G=()=>{const{close:t}=props,o=Y((e=>{e.preventDefault(),y("wordproof:open_authentication")}));return(0,e.createElement)(L,{close:t,title:B("Authentication failed","wordproof_timestamp")},(0,e.createElement)(e.Fragment,null,(0,e.createElement)("p",null,B("Something failed during the authentication of your WordProof account. Please try again or contact the support team.","wordproof_sdk")),(0,e.createElement)(j,{variant:"primary",onClick:o},B("Retry authentication","wordproof_timestamp"))))};G.proptypes={close:h().func.isRequired};var H=G;const{__:U}=wp.i18n,{compose:z}=wp.compose,{withSelect:V}=wp.data,X=t=>{const{close:o,postType:r}=t;return(0,e.createElement)(L,{close:o,title:U("Authenticated","wordproof_timestamp")},(0,e.createElement)("p",null,"You have successfully connected your WordProof account with this site."))};X.proptypes={close:h().func.isRequired};var J=z([V((e=>({postType:e("core/editor").getCurrentPostType()})))])(X);const{__:K}=wp.i18n,Q=t=>{const{close:o}=t;return(0,e.createElement)(L,{close:o,title:K("Webhook failed","wordproof_timestamp")},(0,e.createElement)("p",null,"The timestamp send by WordProof was not received on your website. Please contact support to help solve this problem."))};Q.proptypes={close:h().func.isRequired};var Z=Q;const{useState:ee}=wp.element;var te=()=>{const[t,o]=ee(null);window.addEventListener("wordproof:oauth:success",(()=>{o("oauth:success")}),!1),window.addEventListener("wordproof:oauth:failed",(()=>{o("oauth:failed")}),!1),window.addEventListener("wordproof:oauth:denied",(()=>{o("oauth:denied")}),!1),window.addEventListener("wordproof:webhook:failed",(()=>{o("webhook:failed")}),!1);const r=()=>{o(null)};return(0,e.createElement)(e.Fragment,null,"oauth:success"===t&&(0,e.createElement)(J,{close:r}),"oauth:denied"===t&&(0,e.createElement)($,{close:r}),"oauth:failed"===t&&(0,e.createElement)(H,{close:r}),"webhook:failed"===t&&(0,e.createElement)(Z,{close:r}))};const{__:oe,sprintf:re}=wp.i18n,{PluginDocumentSettingPanel:ne}=wp.editPost,{ToggleControl:ae,PanelRow:se}=wp.components,{compose:ie}=wp.compose,{withSelect:ce,withDispatch:pe}=wp.data,{useState:de,useMemo:ue,useEffect:le}=wp.element,we=t=>{var o;let{postType:r,postMeta:a,isAuthenticated:s,setPostMeta:i}=t;const c=n(),[p]=de(null!==(o=c?.settings?.selected_post_types)&&void 0!==o?o:[]);le((()=>{}),[s,p]);const d=ue((()=>{p.includes(r)}),[p,r]);return(0,e.createElement)(ne,{title:oe("WordProof Timestamp","wordproof_timestamp"),initialOpen:"true"},(0,e.createElement)(se,null,(0,e.createElement)(ae,{label:re(
/* translators: %s expands to the post type */
oe("Timestamp this %s","wordproof-timestamp"),r),onChange:e=>i({_wordproof_timestamp:e}),checked:a._wordproof_timestamp||d,disabled:d}),(0,e.createElement)(W,null),(0,e.createElement)(te,null)))};we.proptypes={postType:h().string.isRequired,postMeta:h().object.isRequired,isAuthenticated:h().bool.isRequired,setPostMeta:h().func.isRequired};var fe=ie([ce((e=>({postMeta:e("core/editor").getEditedPostAttribute("meta"),postType:e("core/editor").getCurrentPostType(),isAuthenticated:e("wordproof").getIsAuthenticated()}))),pe((e=>({setPostMeta(t){e("core/editor").editPost({meta:t})}})))])(we);const{registerPlugin:me}=wp.plugins;me("wordproof-timestamp-panel",{render:()=>(0,e.createElement)(fe,null)}),function(){const{createSuccessNotice:e,createErrorNotice:o}=(0,t.dispatch)("core/notices");k(),function(e,t,o){e(v((async()=>{if(E("wordproof.timestamp",!0)){const e=n("current_post_id"),r=await(async e=>c({path:`wordproof/v1/posts/${e}/timestamp`,method:"POST"}))(e);_({response:r,createSuccessNotice:t,createErrorNotice:o,postId:e})}}),500))}(S,e,o)}()}()}();